<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>python接口自动化测试框架 | Automated Api Pytest</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="docs for automated_api_pytest">
    
    <link rel="preload" href="/docs/assets/css/0.styles.732fc518.css" as="style"><link rel="preload" href="/docs/assets/js/app.400bcfb2.js" as="script"><link rel="preload" href="/docs/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/docs/assets/js/7.86ea1f5a.js" as="script"><link rel="prefetch" href="/docs/assets/js/3.e189cd5d.js"><link rel="prefetch" href="/docs/assets/js/4.d12742be.js"><link rel="prefetch" href="/docs/assets/js/5.216cae74.js"><link rel="prefetch" href="/docs/assets/js/6.2d0a63f8.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.732fc518.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" aria-current="page" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">Automated Api Pytest</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Home
</a></div><div class="nav-item"><a href="https://github.com/wu-clan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/wu_cl" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Home
</a></div><div class="nav-item"><a href="https://github.com/wu-clan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/wu_cl" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>python接口自动化测试框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/#🧠-设计思路" class="sidebar-link">🧠 设计思路</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#🌴-目录结构介绍" class="sidebar-link">🌴 目录结构介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#⬇️-下载" class="sidebar-link">⬇️ 下载</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#指定测试项目" class="sidebar-link">指定测试项目</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#测试用例数据说明" class="sidebar-link">测试用例数据说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/#数据结构展示" class="sidebar-link">数据结构展示</a></li><li class="sidebar-sub-header"><a href="/docs/#参数说明" class="sidebar-link">参数说明</a></li><li class="sidebar-sub-header"><a href="/docs/#参数附加说明" class="sidebar-link">参数附加说明</a></li><li class="sidebar-sub-header"><a href="/docs/#断言类型说明" class="sidebar-link">断言类型说明</a></li><li class="sidebar-sub-header"><a href="/docs/#变量和hooks说明" class="sidebar-link">变量和hooks说明</a></li><li class="sidebar-sub-header"><a href="/docs/#变量表达式" class="sidebar-link">变量表达式</a></li><li class="sidebar-sub-header"><a href="/docs/#用例中的变量替换" class="sidebar-link">用例中的变量替换</a></li><li class="sidebar-sub-header"><a href="/docs/#jsonpath-取值范围" class="sidebar-link">jsonpath 取值范围</a></li></ul></li><li><a href="/docs/#测试用例数据文件创建" class="sidebar-link">测试用例数据文件创建</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#测试用例创建" class="sidebar-link">测试用例创建</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#cli-程序使用说明" class="sidebar-link">cli 程序使用说明</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#🚀-如何运行测试" class="sidebar-link">🚀 如何运行测试</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#🔍-如何查看测试报告" class="sidebar-link">🔍 如何查看测试报告</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/#❓-问题相关" class="sidebar-link">❓ 问题相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/#_1-为什么没有想要的日志内容" class="sidebar-link">1: 为什么没有想要的日志内容</a></li><li class="sidebar-sub-header"><a href="/docs/#_2-为什么没有测试报告" class="sidebar-link">2: 为什么没有测试报告</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="python接口自动化测试框架"><a href="#python接口自动化测试框架" class="header-anchor">#</a> python接口自动化测试框架</h1> <h2 id="🧠-设计思路"><a href="#🧠-设计思路" class="header-anchor">#</a> 🧠 设计思路</h2> <ul><li>python3 + pytest + parametrize + requests / httpx + yaml + allure ...</li></ul> <h2 id="🌴-目录结构介绍"><a href="#🌴-目录结构介绍" class="header-anchor">#</a> 🌴 目录结构介绍</h2> <ul><li>common/: 公共类</li> <li>core/: 配置</li> <li>data/: 测试数据</li> <li>db/: 数据库</li> <li>log/: 日志文件</li> <li>report/: 测试报告存放</li> <li>test_case/: 放置接口自动化测试项目和用例</li> <li>utils/: 工具包</li> <li>conftest.py: pytest.fixture 配置</li> <li>pytest.ini pytest 参数配置</li> <li>run.py: pytest 主程序运行入口</li></ul> <h2 id="⬇️-下载"><a href="#⬇️-下载" class="header-anchor">#</a> ⬇️ 下载</h2> <p>克隆:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://gitee.com/wu_cl/automated_api_pytest.git
</code></pre></div><p>安装依赖包:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt
</code></pre></div><h2 id="指定测试项目"><a href="#指定测试项目" class="header-anchor">#</a> 指定测试项目</h2> <p>为什么要指定测试项目？</p> <p>为了能够将多个项目同时使用此套架构，而设计的这种模式，它的概念大致如下：</p> <ol><li>在主的 test_case 目录下的一级目录视为单个项目目录，如 demo 中的 test_project 目录， 就等于是 test_project
这个项目，需要在此项目目录下存放该项目所有相关的测试用例</li> <li>测试数据文件同样使用此规则，在 data &gt; test_data &gt; excel_data / yaml_data 目录下的一级目录视为单个项目目录，如 demo 中的
test_project 目录， 就等于是 test_project 这个项目，需要在此项目目录下存放该项目所有相关的测试数据</li></ol> <h2 id="测试用例数据说明"><a href="#测试用例数据说明" class="header-anchor">#</a> 测试用例数据说明</h2> <h3 id="数据结构展示"><a href="#数据结构展示" class="header-anchor">#</a> 数据结构展示</h3> <details><summary>yaml 数据</summary> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">config</span><span class="token punctuation">:</span>
  <span class="token key atrule">allure</span><span class="token punctuation">:</span>
    <span class="token key atrule">epic</span><span class="token punctuation">:</span>
    <span class="token key atrule">feature</span><span class="token punctuation">:</span>
    <span class="token key atrule">story</span><span class="token punctuation">:</span>
    <span class="token key atrule">severity</span><span class="token punctuation">:</span>
  <span class="token key atrule">request</span><span class="token punctuation">:</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
    <span class="token key atrule">headers</span><span class="token punctuation">:</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span>
    <span class="token key atrule">verify</span><span class="token punctuation">:</span>
    <span class="token key atrule">redirects</span><span class="token punctuation">:</span>
    <span class="token key atrule">proxies</span><span class="token punctuation">:</span>
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">https</span><span class="token punctuation">:</span>
  <span class="token key atrule">module</span><span class="token punctuation">:</span>

<span class="token key atrule">test_steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span>
    <span class="token key atrule">case_id</span><span class="token punctuation">:</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span>
    <span class="token key atrule">is_run</span><span class="token punctuation">:</span>
    <span class="token key atrule">request</span><span class="token punctuation">:</span>
      <span class="token key atrule">method</span><span class="token punctuation">:</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span>
      <span class="token key atrule">params</span><span class="token punctuation">:</span>
      <span class="token key atrule">headers</span><span class="token punctuation">:</span>
      <span class="token key atrule">body_type</span><span class="token punctuation">:</span>
      <span class="token key atrule">body</span><span class="token punctuation">:</span>
      <span class="token key atrule">files</span><span class="token punctuation">:</span>
    <span class="token key atrule">setup</span><span class="token punctuation">:</span>
      <span class="token key atrule">testcase</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">case_id</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span>
          <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> event_query_001
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span>
          <span class="token key atrule">sql</span><span class="token punctuation">:</span>
          <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> select * from xxx where xxx=xxx
      <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token key atrule">wait_time</span><span class="token punctuation">:</span>
    <span class="token key atrule">teardown</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
      <span class="token key atrule">hooks</span><span class="token punctuation">:</span>
      <span class="token key atrule">extract</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span>
          <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span>
      <span class="token key atrule">assert</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">check</span><span class="token punctuation">:</span>
          <span class="token key atrule">value</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span>
          <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> assert 200 = pm.response.get('status_code')
        <span class="token punctuation">-</span> <span class="token key atrule">check</span><span class="token punctuation">:</span>
          <span class="token key atrule">value</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span>
          <span class="token key atrule">sql</span><span class="token punctuation">:</span>
          <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span>
      <span class="token key atrule">wait_time</span><span class="token punctuation">:</span>
</code></pre></div></details> <details><summary>excel 数据</summary> <p><s>release 版本暂不支持使用，目前这种方式会被提前拦截，就针对 excel 数据提出了参考方案，但
并未实现相关代码，感兴趣的话可以到文件 file_data_parse.py 中查看</s></p></details> <h3 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h3> <p>必填列中 <code>Y / Y</code> 表示如果父级填写则必须填写</p> <table><thead><tr><th style="text-align:left;">参数</th> <th style="text-align:center;">类型</th> <th>必填</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">config</td> <td style="text-align:center;">dict</td> <td>Y</td> <td style="text-align:left;">当前文件中所有测试用例测统一配置</td></tr> <tr><td style="text-align:left;">+ allure</td> <td style="text-align:center;">dict</td> <td>Y</td> <td style="text-align:left;">allure 测试报告配置</td></tr> <tr><td style="text-align:left;">++ epic</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">allure epic</td></tr> <tr><td style="text-align:left;">++ feature</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">allure feature</td></tr> <tr><td style="text-align:left;">++ story</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">allure story</td></tr> <tr><td style="text-align:left;">++ severity</td> <td style="text-align:center;">str / null</td> <td>N</td> <td style="text-align:left;">allure severity: severity、critical、normal、minor、trivial</td></tr> <tr><td style="text-align:left;">+ request</td> <td style="text-align:center;">dict</td> <td>Y</td> <td style="text-align:left;">请求参数</td></tr> <tr><td style="text-align:left;">++ env</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">测试环境文件名, 位于 core/run_env/ 目录下</td></tr> <tr><td style="text-align:left;">++ headers</td> <td style="text-align:center;">dict / null</td> <td>N</td> <td style="text-align:left;">请求头</td></tr> <tr><td style="text-align:left;">++ timeout</td> <td style="text-align:center;">int / null</td> <td>N</td> <td style="text-align:left;">请求超时时长，如果存在且不为空，则应用到当前文件中的所有测试用例，如果不存在或为空，则默认应用 conf.toml 中的配置</td></tr> <tr><td style="text-align:left;">++ verify</td> <td style="text-align:center;">bool / null</td> <td>N</td> <td style="text-align:left;">请求验证，应用同上</td></tr> <tr><td style="text-align:left;">++ redirects</td> <td style="text-align:center;">bool / null</td> <td>N</td> <td style="text-align:left;">重定向，应用同上</td></tr> <tr><td style="text-align:left;">++ proxies</td> <td style="text-align:center;">dict / null</td> <td>N</td> <td style="text-align:left;">请求代理，应用同上</td></tr> <tr><td style="text-align:left;">+++ http</td> <td style="text-align:center;">str / null</td> <td>Y / Y</td> <td style="text-align:left;">http 代理</td></tr> <tr><td style="text-align:left;">+++ https</td> <td style="text-align:center;">str / null</td> <td>Y / Y</td> <td style="text-align:left;">https 代理</td></tr> <tr><td style="text-align:left;">+ module</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">用例所属模块, 为后期设计, 暂未特殊使用</td></tr> <tr><td style="text-align:left;">test_steps</td> <td style="text-align:center;">list / dict</td> <td>Y</td> <td style="text-align:left;">测试步骤, 多条测试用例时，必须使用 list 格式</td></tr> <tr><td style="text-align:left;">+ name</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">测试用例名称</td></tr> <tr><td style="text-align:left;">+ case_id</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">测试用例唯一id</td></tr> <tr><td style="text-align:left;">+ description</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">测试用例描述</td></tr> <tr><td style="text-align:left;">+ is_run</td> <td style="text-align:center;">bool / dict / null</td> <td>Y</td> <td style="text-align:left;">跳过执行此测试用例</td></tr> <tr><td style="text-align:left;">+ request</td> <td style="text-align:center;">dict</td> <td>Y</td> <td style="text-align:left;">请求参数</td></tr> <tr><td style="text-align:left;">++ method</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">请求方式，支持大小写</td></tr> <tr><td style="text-align:left;">++ url</td> <td style="text-align:center;">str</td> <td>Y</td> <td style="text-align:left;">请求链接，不包含域名，域名需在测试环境文件中配置</td></tr> <tr><td style="text-align:left;">++ params</td> <td style="text-align:center;">dict / null</td> <td>Y</td> <td style="text-align:left;">请求/查询参数</td></tr> <tr><td style="text-align:left;">++ headers</td> <td style="text-align:center;">dict / null</td> <td>Y</td> <td style="text-align:left;">请求头，如果为空，则会应用上方配置中的请求头，如果上方也未配置，则不使用请求头</td></tr> <tr><td style="text-align:left;">++ body_type</td> <td style="text-align:center;">str / null</td> <td>Y</td> <td style="text-align:left;">请求数据类型: None、form、x_form、binary、graphQL、text、js、json、html、xml</td></tr> <tr><td style="text-align:left;">++ body</td> <td style="text-align:center;">dict / bytes / null</td> <td>Y</td> <td style="text-align:left;">请求体</td></tr> <tr><td style="text-align:left;">++ files</td> <td style="text-align:center;">dict / null</td> <td>Y</td> <td style="text-align:left;">请求文件上传</td></tr> <tr><td style="text-align:left;">+ setup</td> <td style="text-align:center;">dict / null</td> <td>N</td> <td style="text-align:left;">请求前置</td></tr> <tr><td style="text-align:left;">++ testcase</td> <td style="text-align:center;">list / null</td> <td>N</td> <td style="text-align:left;">前置 testcase，当执行测试用例时，格式应为 List[str]，当设置当前测试执行过程中的缓存变量时，格式应为 List[dict]</td></tr> <tr><td style="text-align:left;">++ sql</td> <td style="text-align:center;">list / null</td> <td>N</td> <td style="text-align:left;">前置 sql，当为执行 sql 时，格式为 List[str]，当为设置变量时，格式为 List[dict]</td></tr> <tr><td style="text-align:left;">++ hooks</td> <td style="text-align:center;">list / null</td> <td>N</td> <td style="text-align:left;">前置函数，调用钩子函数，格式为 List[str]</td></tr> <tr><td style="text-align:left;">++ wait_time</td> <td style="text-align:center;">int / null</td> <td>N</td> <td style="text-align:left;">请求前等待时间</td></tr> <tr><td style="text-align:left;">+ teardown</td> <td style="text-align:center;">dict / null</td> <td>N</td> <td style="text-align:left;">请求后置</td></tr> <tr><td style="text-align:left;">++ sql</td> <td style="text-align:center;">list / null</td> <td>N</td> <td style="text-align:left;">后置 sql，同前置</td></tr> <tr><td style="text-align:left;">++ hooks</td> <td style="text-align:center;">list / null</td> <td>N</td> <td style="text-align:left;">后置函数，同前置</td></tr> <tr><td style="text-align:left;">++ extract</td> <td style="text-align:center;">list / null</td> <td>N</td> <td style="text-align:left;">变量提取, 格式为 List[dict]</td></tr> <tr><td style="text-align:left;">++ assert</td> <td style="text-align:center;">list / str / null</td> <td>N</td> <td style="text-align:left;">断言</td></tr> <tr><td style="text-align:left;">++ wait_time</td> <td style="text-align:center;">int / null</td> <td>N</td> <td style="text-align:left;">请求后等待时间</td></tr></tbody></table> <h3 id="参数附加说明"><a href="#参数附加说明" class="header-anchor">#</a> 参数附加说明</h3> <h4 id="is-run"><a href="#is-run" class="header-anchor">#</a> is_run</h4> <p>test_steps 中的 is_run 参数多种实现方式</p> <ol><li><p>bool 类型值, True / False, 是否跳过执行</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">is_run</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>
</code></pre></div></li> <li><p>dict 类型值, skip + reason, 可自定义跳过执行原因</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">is_run</span><span class="token punctuation">:</span>
  <span class="token key atrule">skip</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>
  <span class="token key atrule">reason</span><span class="token punctuation">:</span> 跳过执行原因
</code></pre></div></li> <li><p>dict 类型值, skip_if + reason, 条件为真时跳过执行</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">is_run</span><span class="token punctuation">:</span>
  <span class="token key atrule">skip_if</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> $<span class="token punctuation">{</span>timeout<span class="token punctuation">}</span> == None
    <span class="token punctuation">-</span> python 表达式
  <span class="token key atrule">reason</span><span class="token punctuation">:</span> 跳过执行原因
</code></pre></div></li></ol> <h4 id="testcase"><a href="#testcase" class="header-anchor">#</a> testcase</h4> <p>setup 中的 testcase 参数支持两种功能</p> <ol><li><p>执行关联测试用例</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">testcase</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> event_query_001
  <span class="token punctuation">-</span> 用例 case_id
</code></pre></div></li> <li><p>设置当前测试用例执行前的缓存变量, 且仅供当前测试用例使用</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">testcase</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">case_id</span><span class="token punctuation">:</span> 关联测试用例的 case_id
    <span class="token key atrule">key</span><span class="token punctuation">:</span> 变量 key，str
    <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span> 值 value<span class="token punctuation">,</span> jsonpath 表达式<span class="token punctuation">,</span> 数据依赖关联测试用例的请求返回数据集
</code></pre></div></li></ol> <h4 id="sql"><a href="#sql" class="header-anchor">#</a> sql</h4> <p>setup / teardown 中的 sql 参数支持两种功能</p> <ol><li><p>执行 sql 语句</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">sql</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> select * from xxx where xxx=xxx
  <span class="token punctuation">-</span> select <span class="token punctuation">...</span>
</code></pre></div></li> <li><p>变量提取</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">sql</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> 变量 key，str
    <span class="token key atrule">type</span><span class="token punctuation">:</span> 变量类型：env / global / cache
    <span class="token key atrule">sql</span><span class="token punctuation">:</span> 执行 sql 查询，str
    <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span> 值 value<span class="token punctuation">,</span> jsonpath 表达式<span class="token punctuation">,</span> 数据依赖 sql 查询结果
</code></pre></div></li></ol> <h4 id="extract"><a href="#extract" class="header-anchor">#</a> extract</h4> <p>teardown 中的 extract 参数支持一种功能</p> <ol><li><p>变量提取</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">extract</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> 变量 key，str
    <span class="token key atrule">type</span><span class="token punctuation">:</span> 变量类型：env / global / cache
    <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span> 值 value<span class="token punctuation">,</span> jsonpath 表达式<span class="token punctuation">,</span> 数据依赖 response 数据集
</code></pre></div></li></ol> <h4 id="assert"><a href="#assert" class="header-anchor">#</a> assert</h4> <ol><li><p>常规断言：</p> <p>与正常 assert 的语法格式一致，但比较值受约束, 比较值从 response 数据集进行取值， 并且以 pm.response.get('') 开始取值，
后面可以继续 get()，也可以使用其他方法，但前提是 python 可执行代码，并且为了避免引号问题，<strong>断言脚本请使用单引号处理</strong>,
E.g:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">assert</span><span class="token punctuation">:</span> assert xxx 条件 pm.response.get('xxx')<span class="token punctuation">,</span> <span class="token string">'错误说明'</span>
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">assert</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> assert xxx 条件 pm.response.get('xxx')
  <span class="token punctuation">-</span> assert xxx 条件 pm.response.get('xxx').get('xxx')<span class="token punctuation">,</span> <span class="token string">'错误说明'</span>
</code></pre></div></li> <li><p>jsonpath 断言:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">assert</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">check</span><span class="token punctuation">:</span> 断言说明 / 错误信息<span class="token punctuation">,</span> str / None，为空时，将展示内部定义信息
    <span class="token key atrule">value</span><span class="token punctuation">:</span> 想要进行比较的值<span class="token punctuation">,</span> Any
    <span class="token key atrule">type</span><span class="token punctuation">:</span> 断言类型，str
    <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span> jsonpath 表达式<span class="token punctuation">,</span> 数据依赖用例的请求返回的数据集
</code></pre></div></li> <li><p>sql 断言:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">assert</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">check</span><span class="token punctuation">:</span> 断言说明 / 错误信息<span class="token punctuation">,</span> str / None，为空时，将展示内部定义信息
    <span class="token key atrule">value</span><span class="token punctuation">:</span> 想要进行比较的值<span class="token punctuation">,</span> Any
    <span class="token key atrule">type</span><span class="token punctuation">:</span> 断言类型，str
    <span class="token key atrule">sql</span><span class="token punctuation">:</span> 执行 sql 查询，str
    <span class="token key atrule">jsonpath</span><span class="token punctuation">:</span> jsonpath 表达式<span class="token punctuation">,</span> 数据依赖 sql 查询结果
</code></pre></div></li></ol> <h3 id="断言类型说明"><a href="#断言类型说明" class="header-anchor">#</a> 断言类型说明</h3> <ul><li><code>eq</code>: 预期结果与实际结果相等</li> <li><code>not_eq</code>: 预期结果不等于实际结果</li> <li><code>gt</code>: 预期结果大于实际结果</li> <li><code>ge</code>: 预期结果大于等于实际结果</li> <li><code>lt</code>: 预期结果小于实际结果</li> <li><code>le</code>: 预期结果小于等于实际结果</li> <li><code>str_eq</code>: 预期结果和实际结果字符串相等</li> <li><code>len_eq</code>: 预期结果长度等于实际结果</li> <li><code>not_len_eq</code>: 预期结果长度不等于实际结果</li> <li><code>len_lt</code>: 预期结果长度小于实际结果</li> <li><code>len_le</code>: 预期结果长度小于等于实际结果</li> <li><code>len_gt</code>: 预期结果长度大于实际结果</li> <li><code>len_ge</code>: 预期结果长度大于等于实际结果</li> <li><code>contains</code>: 预期结果内容包含在实际结果中</li> <li><code>not_contains</code>: 预期结果内容不包含在实际结果中</li> <li><code>startswith</code>: 实际结果的开头是预期结果</li> <li><code>endswith</code>: 实际结果的结尾是预期结果</li></ul> <h3 id="变量和hooks说明"><a href="#变量和hooks说明" class="header-anchor">#</a> 变量和hooks说明</h3> <h4 id="_1-变量"><a href="#_1-变量" class="header-anchor">#</a> 1. 变量</h4> <ul><li>global: 全局变量, 仅在 data 目录下的 <code>global_vars.yaml</code> 文件中以键值对形式进行定义</li> <li>env: 环境变量, 在测试用例依赖的环境文件中以键值对的形式进行定义</li> <li>cache: 缓存变量, 在同一python包下运行测试用例时，在系统内存中定义，例如在 hooks 方法中调用缓存变量写入方法实现定义</li></ul> <h4 id="_2-hooks"><a href="#_2-hooks" class="header-anchor">#</a> 2. hooks</h4> <p>仅在 data 目录下的 hooks.py 文件中定义，根据定义结构在用例数据文件中使用</p> <h3 id="变量表达式"><a href="#变量表达式" class="header-anchor">#</a> 变量表达式</h3> <p>变量和 hooks 开头请遵循规则: a-zA-Z_</p> <ul><li><p>普通变量：测试用例全局可用</p> <div class="language-text extra-class"><pre class="language-text"><code>${var} 或 $var
</code></pre></div></li> <li><p>关联测试用例变量：只在测试用例中含有关联测试用例提取并需要引用关联测试用例设置的变量时，使用此方式</p> <div class="language-text extra-class"><pre class="language-text"><code>^{var} 或 ^var
</code></pre></div></li> <li><p>hooks：全局可用，在测试用例前后置 hooks 参数下只执行代码, 在其他地方使用时, 将执行代码并替换为返回值</p> <div class="language-text extra-class"><pre class="language-text"><code>${func()}
</code></pre></div></li></ul> <h3 id="用例中的变量替换"><a href="#用例中的变量替换" class="header-anchor">#</a> 用例中的变量替换</h3> <h4 id="普通变量"><a href="#普通变量" class="header-anchor">#</a> 普通变量：</h4> <p>请求数据解析时，寻找变量顺序为： cache &gt; env &gt; global，找到变量自动替换数据，未找到抛出异常</p> <ul><li>env：在当前测试用例数据所调用的测试环境文件中进行持久化写入，键值不会重复，新值覆盖旧值</li> <li>global: 在全局变量文件中进行持久化写入，键值不会重复，新值覆盖旧值</li> <li>cache：写入当前指定运行的测试用例目录下所有用例运行过程的内存中，不会持久化，运行结束后自动清除</li></ul> <h6 id="温馨提示-变量持久化写入会冲刷掉手写注释内容"><a href="#温馨提示-变量持久化写入会冲刷掉手写注释内容" class="header-anchor">#</a> 温馨提示: 变量持久化写入会冲刷掉手写注释内容</h6> <h4 id="关联测试用例变量"><a href="#关联测试用例变量" class="header-anchor">#</a> 关联测试用例变量：</h4> <p>关联测试用例执行后，在 cache 变量中寻找，找到变量自动替换数据，未找到抛出异常</p> <ul><li>cache: 默认仅使用 cache 存储变量，需在请求前置中关联测试用例，当前测试用例执行后自动删除</li></ul> <h3 id="jsonpath-取值范围"><a href="#jsonpath-取值范围" class="header-anchor">#</a> jsonpath 取值范围</h3> <p>又称 response 数据集, 根结构如下（可在 send_request.py 文件中查看）：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求连接&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;status_code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求状态码&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;elapsed&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求耗时&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;headers&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求头&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;cookies&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求 cookies&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求返回 json&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求返回内容&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求返回文本&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;stat&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;execute_time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求执行时间&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="测试用例数据文件创建"><a href="#测试用例数据文件创建" class="header-anchor">#</a> 测试用例数据文件创建</h2> <ol><li>使用 cli 程序自动导入</li> <li>根据数据结构及参数说明，手动编写测试用例数据文件</li></ol> <h2 id="测试用例创建"><a href="#测试用例创建" class="header-anchor">#</a> 测试用例创建</h2> <ol><li>通过 cli 程序自动生成测试用例</li> <li>根据数据结构及参数说明，手动编写测试用例</li></ol> <h2 id="cli-程序使用说明"><a href="#cli-程序使用说明" class="header-anchor">#</a> cli 程序使用说明</h2> <ol><li><p>在 fastpt/ 目录下打开终端</p> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token builtin class-name">cd</span> fastpt
</code></pre></div></li> <li><p>查看 cli 程序使用帮助:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>python cli.py <span class="token parameter variable">--help</span>
</code></pre></div></li> <li><p>根据帮助说明, 进行其他操作</p></li></ol> <h2 id="🚀-如何运行测试"><a href="#🚀-如何运行测试" class="header-anchor">#</a> 🚀 如何运行测试</h2> <p>运行 run.py 文件即可, 详细参数说明请查看 run.py 文件</p> <h2 id="🔍-如何查看测试报告"><a href="#🔍-如何查看测试报告" class="header-anchor">#</a> 🔍 如何查看测试报告</h2> <p>测试执行完毕后到 report 文件夹下查看</p> <h2 id="❓-问题相关"><a href="#❓-问题相关" class="header-anchor">#</a> ❓ 问题相关</h2> <h3 id="_1-为什么没有想要的日志内容"><a href="#_1-为什么没有想要的日志内容" class="header-anchor">#</a> 1: 为什么没有想要的日志内容</h3> <p>日志内容需要手动写入, 详细示例demo中几乎都有体现, 请自行查看</p> <h3 id="_2-为什么没有测试报告"><a href="#_2-为什么没有测试报告" class="header-anchor">#</a> 2: 为什么没有测试报告</h3> <ul><li><p>html：自动生成，检查 run 参数是否开启 html 报告创建, 默认开启</p></li> <li><p>yaml：自动生成，用于测试结果统计</p></li> <li><p><s>excel：当前 release 版本已不适用</s></p></li> <li><p><a href="https://www.yuque.com/poloyy/python/aiqlmi" target="_blank" rel="noopener noreferrer">allure<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：自动生成, 默认开启并自动打开浏览器访问, 前提已正确安装 allure 程序</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.400bcfb2.js" defer></script><script src="/docs/assets/js/2.733019b2.js" defer></script><script src="/docs/assets/js/7.86ea1f5a.js" defer></script>
  </body>
</html>
